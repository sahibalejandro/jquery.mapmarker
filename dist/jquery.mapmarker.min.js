/* sahib-map-marker v1.1.0 | Sahib J. Leo | License: MIT | http://sahib.io */
!function(a){function e(e,t){var r=this,o=this.data("mapMarker").options.resultTemplate,n=a(this.data("mapMarker").options.resultsView);n.empty(),t==google.maps.GeocoderStatus.OK&&a.each(e,function(e,t){var i=o.replace(":address",t.formatted_address),s=a(i);s.data("geocoderResult",t),s.on("click",function(e){e.preventDefault();var t=a(this).data().geocoderResult.geometry.location,o=r.data("mapMarker");o.map.panTo(t),o.map.setZoom(o.options.resultZoom),r.mapMarker("setLocation",t)}),n.append(s)})}function t(e,t){if(!e)return t;var r=a(e).val();return r?r:t}var r={lat:0,lng:0,latField:null,lngField:null,onChange:function(){},onSearchStart:function(){},onSearchEnd:function(){},resultZoom:15,mapOptions:{mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:13},markerOptions:{draggable:!0},resultsView:null,resultTemplate:'<a href="#">:address</a>'},o={init:function(e){var o=this,n=a.extend({},r,e),i={map:null,marker:null,geocoder:null,options:n,isSearching:!1},s=t(n.latField,n.lat),l=t(n.lngField,n.lng),p=new google.maps.LatLng(s,l);return i.marker=new google.maps.Marker(n.markerOptions),i.map=new google.maps.Map(this.get(0),n.mapOptions),i.geocoder=new google.maps.Geocoder,this.data("mapMarker",i),i.marker.setMap(i.map),i.map.setCenter(p),this.mapMarker("setLocation",p),google.maps.event.addListener(i.map,"click",function(a){o.mapMarker("setLocation",a.latLng)}),google.maps.event.addListener(i.marker,"dragend",function(){o.mapMarker("notifyNewLocation")}),this},setLocation:function(a){var e=this.data("mapMarker");return e.marker.setPosition(a),this.mapMarker("notifyNewLocation"),this},notifyNewLocation:function(){var e=this.data("mapMarker").marker.getPosition(),t=this.data("mapMarker").options.latField,r=this.data("mapMarker").options.lngField;return t&&r&&(a(t).val(e.lat()),a(r).val(e.lng())),this.data("mapMarker").options.onChange.call(this,e),this},search:function(a){var t=this;return this.mapMarker("disable",!0),this.data("mapMarker").options.onSearchStart.call(this),this.data("mapMarker").geocoder.geocode({address:a},function(a,r){t.mapMarker("disable",!1),e.call(t,a,r),t.data("mapMarker").options.onSearchEnd.call(this,r)}),this},disable:function(e){if(e){var t=a('<div class="mapmarker-disable">').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",backgroundColor:"rgba(255,255,255,0.5)"});this.append(t)}else this.find(".mapmarker-disable").remove();return this},getMap:function(){return this.data("mapMarker").map}};a.fn.mapMarker=function(e){return o[e]?o[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void a.error("Method "+e+" does not exists in jQuery.mapMarker"):o.init.apply(this,arguments)}}(jQuery);